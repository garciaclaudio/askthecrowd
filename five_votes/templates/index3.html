{% load i18n %}
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html> 
    <head>
		<meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1" />
		<title>{% trans "Five Votes" %}</title>
		<script type="text/javascript" src="js/jquery-1.3.2.min.js"></script>
		<script type="text/javascript" src="js/jquery-ui-1.7.2.custom.min.js"></script>
                <script type="text/javascript" src="js/jquery.form.js"></script>

<style type="text/css">

div.centered_container {top: 0; left: 0; width: 100%; height: 100%; display: table}

p.centered_paragraph {display: table-cell; vertical-align: middle; text-align:center;}

#main_container {
    display:none;
    text-align: center;
    margin-left:auto; 
    margin-right:auto; 
}

.photo_card {
  display: inline-block;
//  float: left;
  width: 310px;
  height: 352px;
  margin: 4px;
  background-color: #ffe5fc;
  padding: 6px;
  -moz-border-radius: 4px;
  -webkit-border-radius: 4px;
  border-radius: 4px;
}


.my_button, button.my_button {
	/* layout */
	padding: .3em .9em;
	/* text */
	font-size: 1em;
	/* color */
	background-color: #0896FF;
	color: #FFF;
	/* border and roundedness */
#	border: 4px solid #fff;
	-moz-border-radius: 4px;
	-webkit-border-radius: 4px;
	border-radius: 4px;
	/* shadow */
	-moz-box-shadow: 1px 1px 2px #999;
	-webkit-box-shadow: 1px 1px 2px #999;
	box-shadow: 1px 1px 2px #999;
	filter: progid:DXImageTransform.Microsoft.Shadow(color='#999999', direction='120', strength='2');
	-moz-background-clip: padding;
	-webkit-background-clip: padding-box;
	background-clip: padding-box;
        font-weight:bold;
}

.my_button:hover, button.my_button:hover, button.my_button_hover {
	background-color: #003580;
	cursor: pointer;
	-webkit-transition: all 0.1s ease-in-out;
	-moz-transition: all 0.1s ease-in-out;
	-o-transition: all 0.1s ease-in-out;
}

</style>

        {% include "control.inc" %}

    </head>
<body>

   <div id="fb-root"></div>

   <script>
        window.fbAsyncInit = function() {
          FB.init({
            appId      : '331909936825023',
            channelUrl : '//five-votes.appspot.com/channel.html',
            status     : true, 
            cookie     : true,
            xfbml      : true
          });

          //
          // when the user clicks the login button, this event is fired,
          // response contains the user data, but we prefer to reload
          // so that a user is created
          //
          FB.Event.subscribe('auth.login', function(response) {
              // Reload the entire page. Could also do an Ajax request and dynamically
              // update the already loaded page.
              window.location.reload(true);
          });
//
//          FB.ui({ method: 'feed', 
//                  message: 'Facebook for Websites is super-cool'});

            FB.getLoginStatus(function(response) {

              if (response.status === 'connected') {
                // the user is logged in and connected to your
                // app, and response.authResponse supplies
                // the user's ID, a valid access token, a signed
                // request, and the time the access token 
                // and signed request each expire
                var uid = response.authResponse.userID;
                var accessToken = response.authResponse.accessToken;

                $('#main_container').fadeIn('fast');
            
//            alert('user connected ' +  uid + ' -- ' + accessToken );

// XXX poner codigo en un div, llamar FB.XFBML.Host.parseDomTree();
// (ver index.html)
//                   $('#login_div').html(
//                      "<p><fb:profile-pic uid='loggedinuser' facebook-logo='true'></fb:profile-pic> Welcome, <fb:name uid='loggedinuser' useyou='false'></fb:name>. You are logged in with your Facebook account.</p>" );
//                   FB.XFBML.parse( document.getElementById('login_div') );

              } else if (response.status === 'not_authorized') {
                // the user is logged in to Facebook, 
                //but not connected to the app

                $('#welcome_msg').show();

//            alert( 'not authorized' );
            
              } else {
                // the user isn't even logged in to Facebook.
            
            alert( 'not logged in to FB' );
            
              }
            
            });
        };

        (function(d){
           var js, id = 'facebook-jssdk'; if (d.getElementById(id)) {return;}
           js = d.createElement('script'); js.id = id; js.async = true;
           js.src = "//connect.facebook.net/en_US/all.js";
           d.getElementsByTagName('head')[0].appendChild(js);
         }(document));

    </script>

<div id="welcome_msg" style="display:none;">Welcome, in order to use this app, you must sign in with your facebook account:
</div>

<fb:login-button show-faces="true"></fb:login-button>

{% include "lang_selector.html" %}

<div id="main_container" >
    <div id="question_form_div">
        <form id="question_form" action="/ajax.html" method="get">
            <div style="display: none">
              <input type="hidden" name="_csrf_token" value="{{ csrf_token }}">
              <input type="hidden" name="action" value="create_question">
              <input type="hidden" id="initial_answers" name="initial_answers" value="">
            </div>
            <div>
                <label for="question">{% trans "Your question" %}</label><br />
                <textarea class="text" name="question" id="question" rows="2" cols="45"></textarea>
            </div>
            <button type="submit" id="create_question_button" class="my_button">{% trans "Create" %}</button>
        </form>
    </div>

    <div id="question_created" style="display:none;"> 
        <p>¡Pregunta creada! La página de tu pregunta es:</p>
        <p>http://apps.facebook.com/mipregunta/<span id="new_question_id_num"></span></p>
        <p>Puedes invitar amigos a contestarla. [Invitar amigos] [TODO]</p>
    </div>    

</div> <!-- main container -->

<p>Locale is: {{locale}}</p>

<p>User there is: {{user_there}}</p>

</body>
</html>

